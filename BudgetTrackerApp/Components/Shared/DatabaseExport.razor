@using BudgetTrackerApp.Data.Services.Export
@rendermode InteractiveServer
@namespace BudgetTrackerApp.Components
@inject DatabaseExportService ExportService
@inject IJSRuntime JS

<MudIconButton Icon="@Icons.Material.Filled.CloudDownload"
               Color="Color.Inherit"
               Size="Size.Medium" 
               Variant="Variant.Text"
               OnClick="DownloadBackup" />

@code {
    private async Task DownloadBackup()
    {
        var zipBytes = ExportService.ExportDatabaseAsZip();
        var fileName = $"backup_{DateTime.Now:yyyyMMdd_HHmm}.zip";

        using var stream = new MemoryStream(zipBytes);
        var streamRef = new DotNetStreamReference(stream);

        await JS.InvokeVoidAsync("downloadFileFromStream", fileName, streamRef);
    }
}
